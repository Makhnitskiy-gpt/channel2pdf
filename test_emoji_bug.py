#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –±–∞–≥–∞ —Å —ç–º–æ–¥–∑–∏ –≤ PDF.

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF —Å —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π —ç–º–æ–¥–∑–∏,
—á—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø–µ—Ä–≤–æ–≥–æ —ç–º–æ–¥–∑–∏ (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã).
"""

import os
from datetime import datetime
from pdf_builder import create_pdf


def test_emoji_rendering():
    """
    –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–π PDF —Å –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π —ç–º–æ–¥–∑–∏.
    """
    # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    tmp_dir = "./tmp"
    os.makedirs(tmp_dir, exist_ok=True)

    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π —ç–º–æ–¥–∑–∏
    test_posts = [
        {
            "date": datetime(2025, 7, 18),
            "text": "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –±–∞–≥–∞ —Å —ç–º–æ–¥–∑–∏.\n\n–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—Å–µ —ç–º–æ–¥–∑–∏ –≤ —Ä–µ–∞–∫—Ü–∏—è—Ö.",
            "views": 2739,
            "reactions": [
                {"emoji": "ü¶ü", "count": 1},  # Mosquito emoji
                {"emoji": "‚ù§Ô∏è", "count": 59},  # Heart with variation selector (–ü–†–û–ë–õ–ï–ú–ù–û–ï)
                {"emoji": "üëç", "count": 33},  # Thumbs up
                {"emoji": "üî•", "count": 12},  # Fire
            ]
        },
        {
            "date": datetime(2025, 7, 19),
            "text": "–í—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —ç–º–æ–¥–∑–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.",
            "views": 1500,
            "reactions": [
                {"emoji": "üòÇ", "count": 45},
                {"emoji": "‚ù§Ô∏è", "count": 30},  # –ï—â—ë –æ–¥–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ
                {"emoji": "üéâ", "count": 20},
            ]
        },
        {
            "date": datetime(2025, 7, 20),
            "text": "–¢—Ä–µ—Ç–∏–π –ø–æ—Å—Ç - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —ç–º–æ–¥–∑–∏.",
            "views": 890,
            "reactions": [
                {"emoji": "‚ù§Ô∏è", "count": 100},  # Variation selector
                {"emoji": "‚≠ê", "count": 50},   # Star (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å/–±–µ–∑ variation selector)
                {"emoji": "‚úÖ", "count": 25},   # Check mark
                {"emoji": "üôè", "count": 15},   # Folded hands
            ]
        }
    ]

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
    output_file = os.path.join(tmp_dir, "emoji_bug_test.pdf")
    channel_name = "–¢–µ—Å—Ç–æ–≤—ã–π –∫–∞–Ω–∞–ª (–ø—Ä–æ–≤–µ—Ä–∫–∞ —ç–º–æ–¥–∑–∏)"

    print(f"–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Ç–µ—Å—Ç–æ–≤—ã–π PDF: {output_file}")
    pdf_path = create_pdf(test_posts, output_file, channel_name)

    print(f"\n‚úÖ PDF —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {pdf_path}")
    print(f"\nüìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ:")
    print(f"1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: {pdf_path}")
    print(f"2. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Ä–µ–∞–∫—Ü–∏–π –ø–æ–¥ –¥–∞—Ç–æ–π –ø–æ—Å—Ç–∞")
    print(f"3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ '—Å–µ—Ä—ã—Ö —É—à–µ–∫' –∏–ª–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –Ω–∞–¥/–ø–µ—Ä–µ–¥ ‚ù§Ô∏è")
    print(f"4. –ö–∞–∂–¥–æ–µ —ç–º–æ–¥–∑–∏ –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π")

    return pdf_path


if __name__ == "__main__":
    test_emoji_rendering()
