# üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ Channel2PDF

–ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –º–µ—Ç—Ä–∏–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Channel2PDF.

---

## üéØ –û–±–∑–æ—Ä

–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **–¥–≤—É—Ö —Å–ª–æ—ë–≤**:

1. **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–æ–±—ã—Ç–∏–π–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
2. **–í–Ω–µ—à–Ω–∏–π —Å—á—ë—Ç—á–∏–∫** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–æ–π, Plausible, Google Analytics 4 –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

## üìù –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –õ–æ–≥–∏—Ä—É–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

–ú–æ–¥—É–ª—å `analytics.py` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è |
|---------|----------|------------------|
| `page_view` | –ü—Ä–æ—Å–º–æ—Ç—Ä –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã | –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `/` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ) |
| `export_started` | –ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF | –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ |
| `export_success` | –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF | –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è PDF-—Ñ–∞–π–ª–∞ |
| `export_failed` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF | –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ |
| `lang_changed` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ | –ü—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è

–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `server.log` –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ JSON:

```json
{
  "timestamp": "2025-11-19T12:34:56.789Z",
  "event_type": "export_started",
  "path": "/generate",
  "lang": "ru",
  "client_ip_hash": "a1b2c3d4e5f6g7h8",
  "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...",
  "extra": {
    "channel_input": "@durov",
    "date_from": "2024-01-01",
    "date_to": "2024-12-31"
  }
}
```

#### –ü–æ–ª—è —Å–æ–±—ã—Ç–∏—è:

- **timestamp** ‚Äî –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (UTC)
- **event_type** ‚Äî —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (—Å–º. —Ç–∞–±–ª–∏—Ü—É –≤—ã—à–µ)
- **path** ‚Äî –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
- **lang** ‚Äî —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (`ru` / `en`)
- **client_ip_hash** ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IP-–∞–¥—Ä–µ—Å (SHA-256, –ø–µ—Ä–≤—ã–µ 16 —Å–∏–º–≤–æ–ª–æ–≤)
- **user_agent** ‚Äî User-Agent –±—Ä–∞—É–∑–µ—Ä–∞ (–æ–±—Ä–µ–∑–∞–Ω –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)
- **extra** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–≥–∏

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ **`server.log`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–±—ã—Ç–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

```bash
# –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
grep '"event_type"' server.log

# –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
grep '"event_type": "export_success"' server.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
grep '"event_type": "export_failed"' server.log | jq '.extra.error_type' | sort | uniq -c
```

*(–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ `jq` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON)*

### –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ú–æ–¥—É–ª—å –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç:**
- ‚ùå –†–µ–∞–ª—å–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞ (—Ç–æ–ª—å–∫–æ —Ö—ç—à–∏)
- ‚ùå –¢–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏ API
- ‚ùå –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–æ–≤ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
- ‚ùå –ü–æ–ª–Ω—ã–µ traceback –æ—à–∏–±–æ–∫ (—Ç–æ–ª—å–∫–æ —Ç–∏–ø –æ—à–∏–±–∫–∏)

**–ú–æ–¥—É–ª—å –ª–æ–≥–∏—Ä—É–µ—Ç:**
- ‚úÖ –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –•—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IP (–Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–π)
- ‚úÖ –ö—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–Ω–∞–ª–µ (–æ–±—Ä–µ–∑–∞–Ω–æ –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –î–∞—Ç—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ –¢–∏–ø –æ—à–∏–±–∫–∏ (–±–µ–∑ –¥–µ—Ç–∞–ª–µ–π)

---

## üîå –í–Ω–µ—à–Ω–∏–π —Å—á—ë—Ç—á–∏–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å

–ú–æ–¥—É–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ª—é–±—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å—á—ë—Ç—á–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ANALYTICS_SNIPPET`.

#### 1. –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞

```bash
# –í .env —Ñ–∞–π–ª–µ –∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Render/Heroku:
ANALYTICS_SNIPPET='<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(YOUR_COUNTER_ID, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/YOUR_COUNTER_ID" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->'
```

**–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_COUNTER_ID` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID —Å—á—ë—Ç—á–∏–∫–∞.**

#### 2. Plausible Analytics

```bash
ANALYTICS_SNIPPET='<script defer data-domain="yourdomain.com" src="https://plausible.io/js/script.js"></script>'
```

**–ó–∞–º–µ–Ω–∏—Ç–µ `yourdomain.com` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω.**

#### 3. Google Analytics 4 (GA4)

```bash
ANALYTICS_SNIPPET='<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag("js", new Date());

  gtag("config", "G-XXXXXXXXXX");
</script>'
```

**–ó–∞–º–µ–Ω–∏—Ç–µ `G-XXXXXXXXXX` –Ω–∞ –≤–∞—à Measurement ID.**

#### 4. –õ—é–±–æ–π –¥—Ä—É–≥–æ–π —Å—á—ë—Ç—á–∏–∫

–ü—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ `<script>...</script>` –∫–æ–¥ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ANALYTICS_SNIPPET`.

### –ì–¥–µ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â—ë–Ω –∫–æ–¥ —Å—á—ë—Ç—á–∏–∫–∞

–ö–æ–¥ –∏–∑ `ANALYTICS_SNIPPET` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `<head>` —Å–µ–∫—Ü–∏—é —Ñ–∞–π–ª–∞ `templates/index.html`:

```html
<!-- –í–Ω–µ—à–Ω–∏–π —Å—á—ë—Ç—á–∏–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞, Plausible, GA4, –∏ —Ç.–¥.) -->
{% if analytics_snippet %}
{{ analytics_snippet | safe }}
{% endif %}
```

---

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
from analytics import log_event

log_event(
    event_type="custom_event",
    request=request,
    extra={
        "custom_field": "value",
        "another_field": 123
    }
)
```

### –ì–æ—Ç–æ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ú–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–æ–±—ã—Ç–∏–π:

```python
from analytics import (
    log_page_view,
    log_export_started,
    log_export_success,
    log_export_failed,
    log_lang_changed
)

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
log_page_view(request)

# –ù–∞—á–∞–ª–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
log_export_started(
    request=request,
    channel_input="@durov",
    date_from="2024-01-01",
    date_to="2024-12-31"
)

# –£—Å–ø–µ—à–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç
log_export_success(
    request=request,
    channel_input="@durov",
    posts_count=150  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
)

# –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
log_export_failed(
    request=request,
    channel_input="@durov",
    error_type="ChannelNotFoundError"
)

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
log_lang_changed(
    request=request,
    new_lang="en"
)
```

---

## üìç –ì–¥–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è

### –í `web_app.py`

–°–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–æ—á–∫–∞—Ö:

1. **–ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞** ‚Äî [web_app.py:190-195](web_app.py#L190-L195)
   ```python
   log_export_started(
       request=request,
       channel_input=channel.strip(),
       date_from=date_from,
       date_to=date_to
   )
   ```

2. **–£—Å–ø–µ—à–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç** ‚Äî [web_app.py:211-215](web_app.py#L211-L215)
   ```python
   log_export_success(
       request=request,
       channel_input=channel.strip(),
       posts_count=None  # TODO: –ø–µ—Ä–µ–¥–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
   )
   ```

3. **–û—à–∏–±–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞** ‚Äî [web_app.py:243-246](web_app.py#L243-L246), [web_app.py:262-266](web_app.py#L262-L266), –∏ —Ç.–¥.
   ```python
   log_export_failed(
       request=request,
       channel_input=channel.strip(),
       error_type="ChannelNotFoundError"
   )
   ```

---

## üìä –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### 1. CLI-—Å–∫—Ä–∏–ø—Ç `analyze_logs.py`

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CLI-—Å–∫—Ä–∏–ø—Ç:

```bash
python analyze_logs.py
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º (started, success, failed)
- –ö–æ–Ω–≤–µ—Ä—Å–∏—é (success/started –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º
- –û—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–Ω—è–º
- –¢–æ–ø-10 –∫–∞–Ω–∞–ª–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —ç–∫—Å–ø–æ—Ä—Ç–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É Python
- –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `server.log`

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º (`--date-from`, `--date-to`)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è (`--event-type`)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON/CSV (`--format json|csv`)
- –ê–Ω–∞–ª–∏–∑ User-Agent –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø–æ —á–∞—Å–∞–º —Å—É—Ç–æ–∫)

### 2. –í–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/analytics`

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ:

```
http://localhost:8000/admin/analytics
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (started, success, failed, –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
- –¢–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
- –¢–∞–±–ª–∏—Ü—É –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º
- –¢–æ–ø-10 –∫–∞–Ω–∞–ª–æ–≤ –ø–æ —ç–∫—Å–ø–æ—Ä—Ç–∞–º

**–î–æ—Å—Ç—É–ø:**
- ‚ö†Ô∏è –í —Ä–µ–∂–∏–º–µ `ENV=production` —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ **–û–¢–ö–õ–Æ–ß–ï–ù–ê** (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404)
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ `ENV=development` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –Ω–µ-production –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- TODO: –î–æ–±–∞–≤–∏—Ç—å HTTP basic auth –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!

### 3. –ü—Ä–∏–º–µ—Ä—ã bash-–∫–æ–º–∞–Ω–¥ (–¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)

#### –ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è

```bash
grep "$(date +%Y-%m-%d)" server.log | grep '"event_type": "export_started"' | wc -l
```

#### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —É—Å–ø–µ—à–Ω—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–æ–≤

```bash
grep '"event_type": "export_success"' server.log | tail -10 | jq '.'
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫

```bash
grep '"event_type": "export_failed"' server.log | jq -r '.extra.error_type' | sort | uniq -c
```

#### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º

```bash
grep '"event_type": "export_started"' server.log | jq -r '.lang' | sort | uniq -c
```

#### –¢–æ–ø-10 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

```bash
grep '"event_type": "export_started"' server.log | jq -r '.extra.channel_input' | sort | uniq -c | sort -rn | head -10
```

---

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥—É–ª—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

1. **–î–æ–±–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ `log_event` –≤ –Ω—É–∂–Ω–æ–º –º–µ—Å—Ç–µ:**

```python
from analytics import log_event

log_event(
    event_type="new_custom_event",
    request=request,
    extra={
        "custom_data": "value"
    }
)
```

2. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ–∑–¥–∞–π—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ `analytics.py`:**

```python
def log_custom_event(request: Request, custom_data: str) -> None:
    """–õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ."""
    log_event(
        "new_custom_event",
        request,
        extra={"custom_data": custom_data}
    )
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ–±—ã—Ç–∏–π –≤—ã—à–µ.

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ùó –ù–ï –ª–æ–≥–∏—Ä—É–π—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏, API –∫–ª—é—á–∏ –≤ `extra`
- ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–æ–≤
- ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–æ–ª–Ω—ã–µ traceback (—Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–π `error_type`)

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- ‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ, —á–∏—Ç–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ä–µ–∑–∞–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (channel_input, user_agent)
- ‚úÖ –•—ç—à–∏—Ä—É–π—Ç–µ IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- [config.py](config.py#L163-L173) ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `ANALYTICS_SNIPPET`
- [analytics.py](analytics.py) ‚Äî –º–æ–¥—É–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π)
- [log_parser.py](log_parser.py) ‚Äî –º–æ–¥—É–ª—å –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–æ–≤ (–æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è CLI –∏ –≤–µ–±–∞)
- [analyze_logs.py](analyze_logs.py) ‚Äî CLI-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤
- [web_app.py](web_app.py) ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [web_app.py:395-458](web_app.py#L395-L458) ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç `/admin/analytics`
- [templates/index.html](templates/index.html#L79-L82) ‚Äî –≤—Å—Ç–∞–≤–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞
- [templates/admin_analytics.html](templates/admin_analytics.html) ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –ó–∞–ø—É—Å–∫

**CLI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞:**
```bash
cd /path/to/project
python analyze_logs.py
```

**–í–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
uvicorn web_app:app --reload

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# http://localhost:8000/admin/analytics
```

---

## üí° FAQ

**Q: –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –Ω–∞ Render?**
A: –í –¥–∞—à–±–æ—Ä–¥–µ Render –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Logs" –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞. –õ–æ–≥–∏ –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

**Q: –ö–∞–∫ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏?**
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–π—Ç–µ `server.log`:
```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
cp server.log server.log.backup

# –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª
> server.log
```

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**
A: –î–∞! –ü—Ä–æ—Å—Ç–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ `<script>` –≤ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ANALYTICS_SNIPPET`:
```bash
ANALYTICS_SNIPPET='<script>/* –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ */</script><script>/* GA4 */</script>'
```

**Q: –í–ª–∏—è–µ—Ç –ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**
A: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∏ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã. –í–Ω–µ—à–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**Q: –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –µ—Å–ª–∏ –≤ server.log –Ω–µ—Ç JSON-—Å–æ–±—ã—Ç–∏–π?**
A: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥—É–ª—å `analytics.py` –ø–æ–¥–∫–ª—é—á—ë–Ω –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö [web_app.py](web_app.py). –°–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞—Ö. –î–ª—è —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

**Q: –ü–æ—á–µ–º—É `/admin/analytics` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 404 –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ?**
A: –≠—Ç–æ –∑–∞—â–∏—Ç–∞. –í —Ä–µ–∂–∏–º–µ `ENV=production` —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –ø—Ä–æ–¥–µ –Ω—É–∂–Ω–æ:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ENV=development` –∏–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–µ!)
- –ò–õ–ò –¥–æ–±–∞–≤–∏—Ç—å HTTP basic auth –≤ –∫–æ–¥ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Q: –ú–æ–∂–Ω–æ –ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã?**
A: –î–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥—É–ª—å `log_parser.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ JSON, CSV, Excel –∏ —Ç.–¥. –ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–º. –≤ [analyze_logs.py](analyze_logs.py).

---

**üìù –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 19.11.2025
**üë§ –ê–≤—Ç–æ—Ä:** Channel2PDF Team
