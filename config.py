"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env —Ñ–∞–π–ª –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
2. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    ENV=production
    DEMO_MODE=false
    TELEGRAM_API_ID=your_api_id
    TELEGRAM_API_HASH=your_api_hash

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (—Å–º. .env.example)
"""

import os
from pathlib import Path


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
BASE_DIR = Path(__file__).resolve().parent


# ============================================================================
# –ó–ê–ì–†–£–ó–ö–ê –ü–ï–†–ï–ú–ï–ù–ù–´–• –û–ö–†–£–ñ–ï–ù–ò–Ø
# ============================================================================

def load_env():
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç python-dotenv –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ
    —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    """
    env_file = BASE_DIR / '.env'

    if env_file.exists():
        try:
            from dotenv import load_dotenv
            load_dotenv(env_file)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ {env_file}")
        except ImportError:
            print("‚ö†Ô∏è  python-dotenv –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.")
            print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install python-dotenv")
    else:
        # .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        pass


# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_env()


# ============================================================================
# –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ============================================================================

def get_env_bool(key: str, default: bool = False) -> bool:
    """
    –ü–æ–ª—É—á–∞–µ—Ç boolean –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è.

    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: 'true', '1', 'yes', 'on' (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ) –∫–∞–∫ True
    –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–∞–∫ False

    Args:
        key: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
        default: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    Returns:
        bool: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    """
    value = os.getenv(key)
    if value is None:
        return default
    return value.lower() in ('true', '1', 'yes', 'on')


def get_env_int(key: str, default: int = 0) -> int:
    """
    –ü–æ–ª—É—á–∞–µ—Ç integer –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è.

    Args:
        key: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
        default: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    Returns:
        int: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    """
    value = os.getenv(key)
    if value is None:
        return default
    try:
        return int(value)
    except ValueError:
        print(f"‚ö†Ô∏è  –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è {key}: {value}. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {default}")
        return default


# ============================================================================
# ENVIRONMENT (–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
# ============================================================================

# –¢–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: development, production, test
ENV = os.getenv('ENV', 'development')

# –§–ª–∞–≥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
IS_PRODUCTION = ENV == 'production'
IS_DEVELOPMENT = ENV == 'development'


# ============================================================================
# –î–ï–ú–û-–†–ï–ñ–ò–ú
# ============================================================================

# –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞:
# 1. –ï—Å–ª–∏ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ DEMO_MODE –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
# 2. –ï—Å–ª–∏ ENV=production - –í–°–ï–ì–î–ê False (–ø—Ä–æ–¥–∞–∫—à–µ–Ω –ù–ò–ö–û–ì–î–ê –Ω–µ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ)
# 3. –ï—Å–ª–∏ ENV=development - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

_demo_mode_env = os.getenv('DEMO_MODE')

if _demo_mode_env is not None:
    # –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ DEMO_MODE - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    DEMO_MODE = get_env_bool('DEMO_MODE', default=False)
elif IS_PRODUCTION:
    # –ü—Ä–æ–¥–∞–∫—à–µ–Ω - –í–°–ï–ì–î–ê False
    DEMO_MODE = False
    print("üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º: DEMO_MODE = False")
else:
    # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
    DEMO_MODE = True
    print("üîß Development —Ä–µ–∂–∏–º: DEMO_MODE = True (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ENV=production –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞)")


# ============================================================================
# TELEGRAM API
# ============================================================================

# API credentials - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!
# –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ https://my.telegram.org/apps

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ë–ï–ó –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
API_ID = get_env_int('TELEGRAM_API_ID', default=0)
API_HASH = os.getenv('TELEGRAM_API_HASH', '')

# –í–ê–ñ–ù–û: –ï—Å–ª–∏ API credentials –Ω–µ –∑–∞–¥–∞–Ω—ã - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º
if not API_ID or not API_HASH:
    print("‚ö†Ô∏è  API credentials –Ω–µ –∑–∞–¥–∞–Ω—ã - –≤–∫–ª—é—á–µ–Ω DEMO_MODE")
    print("   –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:")
    print("   - TELEGRAM_API_ID")
    print("   - TELEGRAM_API_HASH")
    DEMO_MODE = True


# ============================================================================
# TELEGRAM SESSION
# ============================================================================

# –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Å—Å–∏–∏
SESSION_NAME = os.getenv('TELEGRAM_SESSION_NAME', 'session')


# ============================================================================
# –ê–ù–ê–õ–ò–¢–ò–ö–ê
# ============================================================================

# –í–Ω–µ—à–Ω–∏–π —Å—á—ë—Ç—á–∏–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞, Plausible, GA4, –∏ —Ç.–¥.)
# –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ <script>...</script> –∫–æ–¥ –≤–∞—à–µ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –ù–∞–ø—Ä–∏–º–µ—Ä:
#   ANALYTICS_SNIPPET='<script>/* –í–∞—à –∫–æ–¥ —Å—á—ë—Ç—á–∏–∫–∞ */</script>'
#
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞)
ANALYTICS_SNIPPET = os.getenv('ANALYTICS_SNIPPET', '')


# ============================================================================
# –í–ê–õ–ò–î–ê–¶–ò–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ============================================================================

def validate_config():
    """
    –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
    - –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º
    - API credentials –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–∞–Ω—ã –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
    """
    errors = []
    warnings = []

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ
    if IS_PRODUCTION and DEMO_MODE:
        errors.append("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: DEMO_MODE=True –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!")
        errors.append("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: ENV=production –∏ DEMO_MODE=false")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: API credentials –≤ –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ
    if not DEMO_MODE and (not API_ID or not API_HASH):
        errors.append("‚ùå –û–®–ò–ë–ö–ê: API credentials –Ω–µ –∑–∞–¥–∞–Ω—ã –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞!")
        errors.append("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: TELEGRAM_API_ID –∏ TELEGRAM_API_HASH")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö credentials –≤ –Ω–µ-–¥–µ–º–æ —Ä–µ–∂–∏–º–µ
    if not DEMO_MODE and (API_ID == 28607273 or API_HASH == '55165d607c1d26dca0d0844d437fde2d'):
        warnings.append("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω—ã–µ API credentials!")
        warnings.append("   –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∑–∞–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")

    # –í—ã–≤–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
    if warnings:
        print("\n" + "=" * 60)
        for warning in warnings:
            print(warning)
        print("=" * 60 + "\n")

    # –í—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
    if errors:
        print("\n" + "=" * 60)
        for error in errors:
            print(error)
        print("=" * 60 + "\n")

        if IS_PRODUCTION and DEMO_MODE:
            raise RuntimeError("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ!")

    return len(errors) == 0


# ============================================================================
# –í–´–í–û–î –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
# ============================================================================

def print_config():
    """–í—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)."""
    print("\n" + "=" * 60)
    print("üìã –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø")
    print("=" * 60)
    print(f"–û–∫—Ä—É–∂–µ–Ω–∏–µ:          {ENV}")
    print(f"–î–µ–º–æ-—Ä–µ–∂–∏–º:         {DEMO_MODE}")
    print(f"API ID:             {'[–∑–∞–¥–∞–Ω]' if API_ID else '[–ù–ï –ó–ê–î–ê–ù]'}")
    print(f"API HASH:           {'[–∑–∞–¥–∞–Ω]' if API_HASH else '[–ù–ï –ó–ê–î–ê–ù]'}")
    print(f"Session —Ñ–∞–π–ª:       {SESSION_NAME}")
    print("=" * 60 + "\n")


# –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
validate_config()


# ============================================================================
# –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
# ============================================================================

if __name__ == "__main__":
    """
    –≠—Ç–æ—Ç –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å: python config.py
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
    """
    print_config()

    print("–ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:\n")

    print("üîß –õ–û–ö–ê–õ–¨–ù–ê–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ê (–¥–µ–º–æ-—Ä–µ–∂–∏–º):")
    print("   # –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏")
    print("   # –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ .env:")
    print("   ENV=development")
    print("   DEMO_MODE=true\n")

    print("üöÄ –ü–†–û–î–ê–ö–®–ï–ù (–±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º):")
    print("   ENV=production")
    print("   DEMO_MODE=false")
    print("   TELEGRAM_API_ID=your_api_id")
    print("   TELEGRAM_API_HASH=your_api_hash\n")

    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–¥–µ–º–æ-—Ä–µ–∂–∏–º —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π):")
    print("   ENV=test")
    print("   DEMO_MODE=true\n")
